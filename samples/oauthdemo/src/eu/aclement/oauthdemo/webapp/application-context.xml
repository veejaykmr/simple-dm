<?xml version="1.0" encoding="UTF-8"?>

<beans:beans xmlns="http://www.springframework.org/schema/security" xmlns:beans="http://www.springframework.org/schema/beans" xmlns:oauth="http://spring-security-oauth.codehaus.org/3.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
   xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
              http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-2.0.xsd
              http://spring-security-oauth.codehaus.org/3.0 http://spring-security-oauth.codehaus.org/schema/spring-security-oauth-3.0.xsd
              http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd">

   <context:property-placeholder location="classpath:eu/aclement/oauthdemo/webapp/context.properties" />

   <http auto-config='true' access-denied-page="/login.html">
      <intercept-url pattern="/secure/**" access="ROLE_USER" />
      <intercept-url pattern="/**" access="IS_AUTHENTICATED_ANONYMOUSLY" />

      <form-login authentication-failure-url="/login.html" default-target-url="/index.html" login-page="/login.html" login-processing-url="/login.do" />
      <logout logout-success-url="/index.html" logout-url="/logout.do" />
   </http>

   <authentication-provider>
      <user-service>
         <user name="marissa" password="wombat" authorities="ROLE_USER" />
         <user name="sam" password="kangaroo" authorities="ROLE_USER" />
      </user-service>
   </authentication-provider>

   <oauth:consumer resource-details-service-ref="resourceDetails" oauth-failure-page="/oauth_error.html">
      <oauth:url pattern="/login.html*" resources="googledata" />
   </oauth:consumer>

   <oauth:resource-details-service id="resourceDetails">
      <oauth:resource id="googledata" key="oauthdemoapp.appspot.com" secret="9plnEsclhAPg9+3ZiLR6XRyB" request-token-method="GET" access-token-method="GET" request-token-url="https://www.google.com/accounts/OAuthGetRequestToken" user-authorization-url="https://www.google.com/accounts/OAuthAuthorizeToken"
         access-token-url="https://www.google.com/accounts/OAuthGetAccessToken">
         <oauth:addtionalParameter name="scope" value="http://www.google.com/calendar/feeds" />
      </oauth:resource>
   </oauth:resource-details-service>

   <beans:bean id='myFilter' class='eu.aclement.oauthdemo.security.OAuthAuthenticationFilter'>
      <custom-filter position="LAST" />
      <beans:property name="resourceId" value="${consumer.resourceId}" />
      <beans:property name="authenticationProvider" ref="oauthProvider" />
   </beans:bean>

   <beans:bean id='oauthProvider' class='eu.aclement.oauthdemo.security.OauthUserAuthenticationProvider'>   
      <beans:property name="consumerKey" value="${consumer.key}" />
      <beans:property name="consumerSecret" value='${consumer.secret}' />
   </beans:bean>
   
   <!--<beans:bean id="debugFilter" class="eu.aclement.oauthdemo.security.DebugFilter">
			<custom-filter position="FIRST"/>
	</beans:bean>
--></beans:beans>